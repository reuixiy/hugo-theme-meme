function updateState(){let e=document.getElementById("instance").value.trim()!="";document.getElementById("submit").disabled=!e}function getSoftwareName(e){for(let t of document.querySelectorAll("#fediverse-domains > option"))if(t.value==e)return Promise.resolve(t.getAttribute("data-project"));const t=["http://nodeinfo.diaspora.software/ns/schema/2.0","http://nodeinfo.diaspora.software/ns/schema/2.1"];return fetch(`https://${e}/.well-known/nodeinfo`).then(e=>e.json()).then(e=>{if(e&&Array.isArray(e.links))for(let n of e.links)if(t.includes(n.rel)&&typeof n.href=="string")return fetch(n.href);throw new Exception(".well-known/nodeinfo file does not contain a nodeinfo link")}).then(e=>e.json()).then(e=>{if(e&&e.software&&typeof e.software.name=="string")return e.software.name;throw new Exception("nodeinfo link does not contain a software name")}).catch(e=>(console.error(e),"mastodon"))}document.addEventListener("DOMContentLoaded",()=>{let t=new URLSearchParams(location.hash.slice(1));document.getElementById("title").value=t.get("title"),document.getElementById("url").value=t.get("url");let e=t.get("description");e.length>250&&(e=e.slice(0,249)+"â€¦"),document.getElementById("description").value=e,"mastodonInstance"in localStorage&&(document.getElementById("instance").value=localStorage.mastodonInstance,document.getElementById("rememberInstance").checked=!0),document.getElementById("shareForm").addEventListener("submit",e=>{if(e.preventDefault(),e.target.disabled)return;let t=document.getElementById("instance").value.trim();if(t=t.replace(/^\w+:[/\\]*/,""),t=t.replace(/[/\\].*/,""),document.getElementById("instance").value=t,t=="")return;document.getElementById("rememberInstance").checked?localStorage.mastodonInstance=t:delete localStorage.mastodonInstance;let n=document.getElementById("title").value.trim(),s=document.getElementById("description").value.trim(),o=document.getElementById("url").value.trim(),i=n+`
`+s+`
`+o;getSoftwareName(t).then(e=>{let r=JSON.parse(document.body.getAttribute("data-projects")),a=r.hasOwnProperty(e)?r[e]:r.mastodon;a=a.replace("{title}",encodeURIComponent(n)),a=a.replace("{description}",encodeURIComponent(s)),a=a.replace("{url}",encodeURIComponent(o)),a=a.replace("{text}",encodeURIComponent(i)),location.href=`https://${t}/${a}`})}),document.getElementById("instance").addEventListener("input",updateState),updateState()})