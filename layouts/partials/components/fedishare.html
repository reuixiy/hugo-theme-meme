<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
    {{ .Scratch.Set "fedishare_page" true -}}
    {{ partial "head.html" . }}
    {{ .Scratch.Delete "fedishare_page" -}}
    {{
        $projects := dict
            "calckey" "share?text={text}"
            "diaspora" "bookmarklet?title={title}&notes={description}&url={url}"
            "fedibird" "share?text={text}"
            "firefish" "share?text={text}"
            "foundkey" "share?text={text}"
            "friendica" "compose?title={title}&body={description}%0A{url}"
            "glitchcafe" "share?text={text}"
            "gnusocial" "notice/new?status_textarea={text}"
            "hometown" "share?text={text}"
            "hubzilla" "rpost?title={title}&body={description}%0A{url}"
            "kbin" "new/link?url={url}"
            "lemmy" "create_post?url={url}&title={title}&body={description}"
            "mastodon" "share?text={text}"
            "meisskey" "share?text={text}"
            "microdotblog" "post?text=[{title}]({url})%0A%0A{description}"
            "misskey" "share?text={text}"
    -}}
    <body data-projects="{{ $projects | jsonify }}">
        {{ $domains := slice }}
        {{/* Attempt to load instances from the local JSON file */}}
        {{ $localInstances := getJSON "data/fedi_instances.json" }}
        {{ if $localInstances }}
            {{ $domains = $localInstances }}
        {{ else }}
            {{/* Fallback to a minimal hardcoded list if fedi_instances.json is not found or is empty */}}
            {{ warnf "data/fedi_instances.json not found or empty. Falling back to minimal hardcoded instance list." }}
            {{ $domains = slice
                "mastodon.social"
                "fedibird.com"
                "lemmy.world"
                "kbin.social"
                "pixelfed.social"
                "micro.blog"
                "misskey.io"
                "bookwyrm.social"
                "diasp.org"
            }}
        {{ end }}
        <datalist id="fediverse-domains">
            {{ range $domains -}}
                <option>{{ . }}</option>
            {{ end -}}
        </datalist>
        <div class="container">
            <main class="main single" id="main">
                <div class="main-inner">
                    <article class="content">
                        <noscript><div class="warning">{{ i18n "javascriptRequired" }}</div></noscript>
                        <h1>{{ i18n "shareOnTitle" }}{{ i18n "fediverse" }}</h1>
                        <form id="shareForm">
                            <p>
                                <label>
                                    {{ i18n "fedishareTitleLabel" }}
                                    <input id="title" class="fedishare-title" readonly></textarea>
                                </label>
                            </p>
                            <p>
                                <label>
                                    {{ i18n "fedishareDescriptionLabel" }}
                                    <textarea id="description" class="fedishare-description" rows="7" readonly></textarea>
                                </label>
                            </p>
                            <p>
                                <label>
                                    {{ i18n "fedishareUrlLabel" }}
                                    <input id="url" class="fedishare-url" readonly></textarea>
                                </label>
                            </p>
                            <p>
                                <label>
                                    {{ i18n "fedishareInstanceLabel" }}
                                    <span class="fedishare-instance-container">
                                        https://<input id="instance" class="fedishare-instance" type="text" autofocus list="fediverse-domains">
                                    </span>
                                </label>
                            </p>
                            <p>
                                <label>
                                    <input type="checkbox" id="rememberInstance">
                                    {{ i18n "fedishareRememberInstance" }}
                                </label>
                            </p>
                            <p><button type="submit" class="fedishare-submit" id="submit">{{ i18n "fedishareSubmitLabel" }}</button></p>
                        </form>
                    </article>
                </div>
            </main>
        </div>
    </body>
</html>
