<script data-no-instant>InstantClick.init();</script>

<script data-no-instant>
    InstantClick.on('change', function() {
        wrapTable();

        {{ if .Site.Params.enableBackToTopAutoHide }}
            backToTop();
        {{ end }}

        {{ if and .Site.IsMultiLingual .Site.Params.enableLangToggle }}
            langSwitch();
        {{ end }}

        {{ if .Site.Params.enableDarkMode }}
            const userPrefers = localStorage.getItem('theme');
            const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            const lightModeMediaQuery = window.matchMedia('(prefers-color-scheme: light)');

            if (userPrefers === 'dark') {
                changeModeMeta('dark');
                changeMode('dark');
            } else if (userPrefers === 'light') {
                changeModeMeta('light');
                changeMode('light');
            } else if (darkModeMediaQuery.matches) {
                changeModeMeta('dark');
                changeMode('dark');
            } else if (lightModeMediaQuery.matches) {
                changeModeMeta('light');
                changeMode('light');
            }

            themeSwitch();
        {{ end -}}

        {{ if and .Site.Params.enableComments (eq hugo.Environment "production") }}
            comments();
        {{ end }}

        {{ if and .Site.Params.enableGoogleAnalytics (eq hugo.Environment "production") -}}
            {{ if eq .Site.Params.trackingCodeType "gtag" -}}
                gtag('config', '{{ .Site.Params.trackingID }}', {
                    'page_path': location.pathname + location.search
                });
            {{ end -}}

            {{ if eq .Site.Params.trackingCodeType "analytics" -}}
                ga('send', 'pageview', location.pathname + location.search);
            {{ end -}}
        {{ end -}}
    });
</script>
