{{- $src := partial "utils/lib.html" (dict "$" . "type" "katex") -}}
{{- $srcCSS := partial "utils/lib.html" (dict "$" . "type" "katex-css") -}}
{{- $srcMhchem := partial "utils/lib.html" (dict "$" . "type" "katex-mhchem") -}}
{{- $srcAutoRender := partial "utils/lib.html" (dict "$" . "type" "katex-auto-render") -}}

<link rel="stylesheet" href="{{ $srcCSS }}">
<script>
    if (typeof renderMathInElement === 'undefined') {
        const getScript = (options) => {
            const script = document.createElement('script');
            script.defer = true;
            script.crossOrigin = 'anonymous';
            Object.keys(options).forEach((key) => {
                script[key] = options[key];
            });
            document.body.appendChild(script);
        };
        getScript({
            src: '{{ $src }}',
            onload: () => {
                getScript({
                    src: '{{ $srcMhchem }}',
                    onload: () => {
                        getScript({
                            src: '{{ $srcAutoRender }}',
                            onload: () => {
                                renderKaTex();
                            }
                        });
                    }
                });
            }
        });
    } else {
        renderKaTex();
    }
    function renderKaTex() {
        renderMathInElement(
            document.body,
            {
                delimiters: [
					{ left: "$$", right: "$$", display: true },
					{ left: "\\[", right: "\\]", display: true },
					{ left: "$", right: "$", display: false },
					{ left: "\\(", right: "\\)", display: false },
					{ left: "\\begin{equation}", right: "\\end{equation}", display: true },
					{ left: "\\begin{align}", right: "\\end{align}", display: true },
					{ left: "\\begin{alignat}", right: "\\end{alignat}", display: true },
					{ left: "\\begin{gather}", right: "\\end{gather}", display: true },
					{ left: "\\begin{matrix}", right: "\\end{matrix}", display: true },
					{ left: "\\begin{array}", right: "\\end{array}", display: true },
					{ left: "\\begin{CD}", right: "\\end{CD}", display: true },
				],
            }
        );
    }
</script>
